<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Expense Pro - Ultra Visible</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js">
function openDayModal(){document.getElementById('dayModal').style.display='block';document.getElementById('day-modal-body').innerHTML=document.getElementById('day-summary').innerHTML}
function closeDayModal(){document.getElementById('dayModal').style.display='none'}
function openRemModal(){document.getElementById('remModal').style.display='block';document.getElementById('rem-modal-body').innerHTML=document.getElementById('rem-list').innerHTML}
function closeRemModal(){document.getElementById('remModal').style.display='none'}


function getMonthKey(dateStr){
  const d = new Date(dateStr);
  return d.getFullYear() + "-" + String(d.getMonth()+1).padStart(2,'0');
}

function getCurrentMonthKey(){
  const d = new Date();
  return d.getFullYear() + "-" + String(d.getMonth()+1).padStart(2,'0');
}



</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">
function openDayModal(){document.getElementById('dayModal').style.display='block';document.getElementById('day-modal-body').innerHTML=document.getElementById('day-summary').innerHTML}
function closeDayModal(){document.getElementById('dayModal').style.display='none'}
function openRemModal(){document.getElementById('remModal').style.display='block';document.getElementById('rem-modal-body').innerHTML=document.getElementById('rem-list').innerHTML}
function closeRemModal(){document.getElementById('remModal').style.display='none'}


function getMonthKey(dateStr){
  const d = new Date(dateStr);
  return d.getFullYear() + "-" + String(d.getMonth()+1).padStart(2,'0');
}

function getCurrentMonthKey(){
  const d = new Date();
  return d.getFullYear() + "-" + String(d.getMonth()+1).padStart(2,'0');
}



</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js">
function openDayModal(){document.getElementById('dayModal').style.display='block';document.getElementById('day-modal-body').innerHTML=document.getElementById('day-summary').innerHTML}
function closeDayModal(){document.getElementById('dayModal').style.display='none'}
function openRemModal(){document.getElementById('remModal').style.display='block';document.getElementById('rem-modal-body').innerHTML=document.getElementById('rem-list').innerHTML}
function closeRemModal(){document.getElementById('remModal').style.display='none'}


function getMonthKey(dateStr){
  const d = new Date(dateStr);
  return d.getFullYear() + "-" + String(d.getMonth()+1).padStart(2,'0');
}

function getCurrentMonthKey(){
  const d = new Date();
  return d.getFullYear() + "-" + String(d.getMonth()+1).padStart(2,'0');
}



</script>
  <style>
    :root {
      --bg: #fdfbf7; --emerald: #064e3b; --gold: #b45309; --gold-light: #fef3c7;
      --card: #ffffff; --text: #000000; --danger: #b91c1c; --success: #047857;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
      margin: 0; padding: 12px; background: var(--bg); color: var(--text); 
      font-family: 'Inter', sans-serif; font-weight: 800; line-height: 1.2;
    }
    
    header { 
      display: flex; justify-content: space-between; align-items: center; 
      padding: 18px; background: var(--emerald); border-radius: 18px; 
      margin-bottom: 15px; color: #fff; border: 2.5px solid #000;
    }
    .logo { font-weight: 900; font-size: 20px; color: #fbbf24; }
    .bal-val { font-weight: 900; font-size: 24px; }

    .card { background: var(--card); border-radius: 18px; padding: 18px; margin-bottom: 18px; border: 2.5px solid #000; box-shadow: 4px 4px 0px #000; }
    .section-head { 
      font-size: 15px; font-weight: 900; margin-bottom: 15px; color: var(--emerald); 
      border-bottom: 4px solid var(--gold-light); padding-bottom: 6px; 
      display: flex; justify-content: space-between; align-items: center; text-transform: uppercase;
    }

    label { display: block; font-size: 13px; font-weight: 900; margin-bottom: 5px; color: var(--gold); }
    input, select { 
      width: 100%; padding: 14px; border-radius: 12px; border: 2.5px solid #000; 
      background: #ffffff; color: #000; font-size: 16px; margin-bottom: 15px; 
      font-weight: 900; outline: none;
    }
    
    button { background: var(--emerald); color: white; border: 2.5px solid #000; font-weight: 900; padding: 16px; border-radius: 12px; cursor: pointer; width: 100%; font-size: 15px; }
    .btn-sm { width: auto; padding: 8px 14px; font-size: 12px; border-radius: 10px; }
    .btn-edit { background: #0369a1; }
    .btn-del { background: var(--danger); }
    .btn-gold { background: var(--gold); }
    .btn-view { background: #4f46e5; }

    .row { display: flex; gap: 12px; } .row > div { flex: 1; }

    .day-scroll { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 12px; }
    .day-box { min-width: 115px; background: #fff; padding: 12px; border-radius: 15px; border: 2.5px solid #000; text-align: center; flex-shrink: 0; }
    
    .breakdown-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 2.5px solid #000; }
    .breakdown-nums { display: flex; gap: 15px; font-size: 16px; }

    .tx-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 2px solid #000; }
    .tx-info b { font-size: 17px; display: block; color: #000; }
    .tx-info small { color: #000; font-size: 13px; font-weight: 700; }

    /* Scrolling after 10 transactions */
    #tx-list { max-height: 700px; overflow-y: auto; }

    .rem-item { padding: 15px; margin-bottom: 12px; border-radius: 15px; border: 3px solid #000; }
    .rem-paid { background: #e8f5e9; } 
    .rem-today { background: #fff8e1; } 
    .rem-overdue { background: #ffebee; }

    /* View Mode Modal */
    #view-modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto; padding: 20px;
    }
    .modal-content { background: white; border: 3px solid #000; padding: 20px; border-radius: 15px; max-width: 600px; margin: auto; }
    .report-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .report-table th, .report-table td { border: 2px solid #000; padding: 10px; text-align: left; color: #000; }
    .report-table th { background: #f3f4f6; }

    /* HIDE BUTTONS DURING PRINTING */
    @media print {
      .btn-del, .btn-print-action, #view-modal button, header, .card, .no-print {
        display: none !important;
      }
      #view-modal { position: absolute; background: white; padding: 0; }
      .modal-content { border: none; box-shadow: none; width: 100%; max-width: 100%; }
    }
  
/* Reminder scrolling rules */
#rem-list{
  display:flex;
  gap:12px;
}

/* Desktop: vertical scroll after 5 */
@media (min-width: 769px){
  #rem-list{
    flex-direction:column;
    max-height:420px; /* approx height for 5 items */
    overflow-y:auto;
  }
}

/* Mobile: horizontal scroll after 3 */
@media (max-width: 768px){
  #rem-list{
    flex-direction:row;
    overflow-x:auto;
    max-width:100%;
  }
  .rem-item{
    min-width:260px;
    flex-shrink:0;
  }
}


/* ===== Reminders scrolling FIX ===== */
#rem-list{
  display:flex;
  gap:12px;
}

/* Desktop: vertical scroll, 5 items visible */
@media (min-width:769px){
  #rem-list{
    flex-direction:column;
    max-height:520px; /* height for ~5 reminders */
    overflow-y:auto;
  }
}

/* Mobile: horizontal scroll, 3 items visible */
@media (max-width:768px){
  #rem-list{
    flex-direction:row;
    overflow-x:auto;
  }
  .rem-item{
    min-width:260px;
    flex-shrink:0;
  }
}

</style>

<style>
.arrow-btn{width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;background:#000;color:#fff;border-radius:8px;font-size:14px;padding:0;border:2px solid #000;cursor:pointer;}
.modal-full{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#000c;z-index:3000}
.modal-box{background:#fff;height:100%;max-width:1000px;margin:auto;padding:15px;overflow:auto}
.modal-head{position:sticky;top:0;background:#fff;border-bottom:3px solid #000;
display:flex;justify-content:space-between;align-items:center;padding:10px;z-index:5}
.month-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px}
.cat-table{width:100%;border-collapse:collapse}
.cat-table th,.cat-table td{border:2px solid #000;padding:10px;text-align:center}
.rem-scroll{display:flex;gap:12px;overflow-x:auto}
@media print{
.arrow-btn,.btn-sm{display:none!important}
.modal-full{position:absolute;background:#fff}
}

/* Reminder scrolling rules */
#rem-list{
  display:flex;
  gap:12px;
}

/* Desktop: vertical scroll after 5 */
@media (min-width: 769px){
  #rem-list{
    flex-direction:column;
    max-height:420px; /* approx height for 5 items */
    overflow-y:auto;
  }
}

/* Mobile: horizontal scroll after 3 */
@media (max-width: 768px){
  #rem-list{
    flex-direction:row;
    overflow-x:auto;
    max-width:100%;
  }
  .rem-item{
    min-width:260px;
    flex-shrink:0;
  }
}


/* ===== Reminders scrolling FIX ===== */
#rem-list{
  display:flex;
  gap:12px;
}

/* Desktop: vertical scroll, 5 items visible */
@media (min-width:769px){
  #rem-list{
    flex-direction:column;
    max-height:520px; /* height for ~5 reminders */
    overflow-y:auto;
  }
}

/* Mobile: horizontal scroll, 3 items visible */
@media (max-width:768px){
  #rem-list{
    flex-direction:row;
    overflow-x:auto;
  }
  .rem-item{
    min-width:260px;
    flex-shrink:0;
  }
}

</style>

</head>
<body>

<header>
  <div class="logo">Monthly Expense Tracker </div>
  <div id="top-balance" class="bal-val">₹0.00</div>
</header>

<div class="card">
  <div class="section-head" id="form-title">Add Entry</div>
  <div class="row">
      <div><label>Date</label><input type="date" id="tr-date"></div>
      <div><label>Amount</label><input type="number" step="0.01" id="tr-amount" placeholder="0.00"></div>
  </div>
  <div class="row">
    <div><label>Type</label><select id="tr-type"><option value="expense">Expense (-)</option><option value="income">Income (+)</option></select></div>
    <div><label>Category</label><select id="tr-cat"><option>General</option><option>Home</option><option>Office</option><option>Personal</option><option>Credit</option><option>Others</option></select></div>
  </div>
  <label>Notes</label><input type="text" id="tr-desc" placeholder="Details...">
  <input type="hidden" id="edit-id">
  <button onclick="saveTransaction()">SAVE TRANSACTION</button>
</div>

<div class="card">
  <div class="section-head">Report & Exports</div>
  <div class="row">
      <div><label>From</label><input type="date" id="range-start" onchange="render()"></div>
      <div><label>To</label><input type="date" id="range-end" onchange="render()"></div>
  </div>
  <label>Category Filter</label>
  <select id="filter-cat" onchange="render()">
      <option value="All">All Categories</option>
      <option>General</option><option>Home</option><option>Office</option><option>Personal</option><option>Credit</option><option>Others</option>
  </select>
  <div class="row" style="margin-bottom: 10px;">
      <button onclick="exportExcel()" style="background:var(--success);">EXCEL</button>
      <button onclick="exportPDF()" class="btn-gold">PDF</button>
  </div>
  <button onclick="openViewMode()" class="btn-view">VIEW CURRENT MONTH</button>
</div>

<div class="card">
  <div class="section-head">Day Summary <button class="arrow-btn" onclick="openDayModal()">➜</button></div>
  <div class="day-scroll" id="day-summary"></div>
</div>

<div class="card">
  <div class="section-head">Category Breakdown</div>
  <table class="cat-table"><thead><tr><th style="background:#e0f2fe">Category</th><th style="background:#e0f2fe;color:var(--success)">Income</th><th style="background:#e0f2fe;color:var(--danger)">Expense</th></tr></thead><tbody id="category-breakdown"></tbody></table>
</div>

<div class="card">
  <div class="section-head">Reminders <div><button class="btn-sm btn-gold" onclick="toggleRemForm()">+ NEW</button><span style="display:inline-block;width:8px"></span><button class="arrow-btn" onclick="openRemModal()">➜</button></div></div>
  <div id="rem-form" style="display:none; padding:15px; border: 2.5px solid #000; border-radius: 15px; margin-bottom: 15px;">
      <label>Bill Name</label><input type="text" id="rn" placeholder="Electricity">
      <label>Due Day</label><input type="number" id="rd" placeholder="1-31">
      <input type="hidden" id="rem-edit-id">
      <button onclick="saveReminder()" class="btn-gold">SAVE REMINDER</button>
  </div>
  <div id="rem-list"></div>
</div>

<div class="card">
  <div class="section-head">History</div>
  <div id="tx-list"></div>
</div>

<div class="card no-print" style="border: none; background: transparent; box-shadow: none; padding: 0;">
    <button onclick="exportJSON()" style="background:#000; margin-bottom: 12px;">BACKUP (EXPORT JSON)</button>
    <button onclick="document.getElementById('imp').click()" style="background:#000;">RESTORE (IMPORT JSON)</button>
    <input type="file" id="imp" style="display:none" onchange="importJSON(this)">
</div>

<div id="view-modal">
    <div class="modal-content">
        <div class="section-head">Filtered Report <button class="btn-sm btn-del btn-print-action" onclick="closeViewMode()">CLOSE</button></div>
        <div id="modal-summary" style="margin-bottom: 15px; font-size: 16px;"></div>
        <table class="report-table">
            <thead><tr><th>Date</th><th>Note</th><th>Cat</th><th>Amt</th></tr></thead>
            <tbody id="modal-rows"></tbody>
        </table>
        <button onclick="window.print()" class="btn-print-action" style="margin-top: 20px; background: #000;">PRINT THIS REPORT</button>
    </div>
</div>

<script>
  let db;
  const req = indexedDB.open("StrictTrackerV5", 1);
  req.onupgradeneeded = (e) => {
    db = e.target.result;
    db.createObjectStore("tx", { keyPath: "id", autoIncrement: true });
    db.createObjectStore("rem", { keyPath: "id", autoIncrement: true });
  };
  req.onsuccess = (e) => { db = e.target.result; setToday(); render(); };

  
  function setToday() {
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const dd = String(d.getDate()).padStart(2, '0');
    document.getElementById('tr-date').value = `${yyyy}-${mm}-${dd}`;
  }


  function getFilteredData(callback) {
    const start = document.getElementById('range-start').value;
    const end = document.getElementById('range-end').value;
    const fCat = document.getElementById('filter-cat').value;

    db.transaction("tx").objectStore("tx").getAll().onsuccess = (e) => {
      let filtered = e.target.result.filter(t => {
        let dateOk = (!start || t.date >= start) && (!end || t.date <= end);
        let catOk = (fCat === "All" || t.category === fCat);
        return dateOk && catOk;
      }).sort((a,b) => new Date(b.date) - new Date(a.date));
      callback(filtered);
    };
  }

  function saveTransaction() {
    const d = document.getElementById('tr-date').value, a = parseFloat(document.getElementById('tr-amount').value);
    const ty = document.getElementById('tr-type').value, c = document.getElementById('tr-cat').value;
    const ds = document.getElementById('tr-desc').value || c, eid = document.getElementById('edit-id').value;
    if (!a || !d) return alert("Fill Amount & Date");
    const s = db.transaction("tx", "readwrite").objectStore("tx");
    const obj = { date: d, amount: parseFloat(a.toFixed(2)), type: ty, category: c, desc: ds, monthKey: getMonthKey(d) };
    if (eid) { obj.id = Number(eid); s.put(obj); } else { s.add(obj); }
    document.getElementById('tr-amount').value = ""; document.getElementById('tr-desc').value = "";
    document.getElementById('edit-id').value = ""; setToday(); render();
  }

  function render() {
    const today = new Date().getDate();
    const activeMonth = getCurrentMonthKey();
    getFilteredData((filtered) => {
      filtered = filtered.filter(t => (t.monthKey || getMonthKey(t.date)) === activeMonth);
      let total = 0, dayMap = {}, catMap = {};
      filtered.forEach(t => {
        const isInc = t.type === 'income';
        total += isInc ? t.amount : -t.amount;
        if (!dayMap[t.date]) dayMap[t.date] = { inc: 0, exp: 0 };
        dayMap[t.date][isInc ? 'inc' : 'exp'] += t.amount;
        if (!catMap[t.category]) catMap[t.category] = { inc: 0, exp: 0 };
        catMap[t.category][isInc ? 'inc' : 'exp'] += t.amount;
      });

      document.getElementById('top-balance').innerText = `₹${total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
      document.getElementById('day-summary').innerHTML = Object.keys(dayMap).sort().reverse().map(d => `
        <div class="day-box"><b>${d.split('-').reverse().slice(0,2).join('/')}</b>
          <div style="color:var(--success)">+₹${dayMap[d].inc.toFixed(2)}</div><div style="color:var(--danger)">-₹${dayMap[d].exp.toFixed(2)}</div>
        </div>`).join('');

      document.getElementById('category-breakdown').innerHTML = Object.keys(catMap).map(c=>`<tr><td>${c}</td>`+`<td style="color:var(--success)">+₹${catMap[c].inc.toFixed(2)}</td>`+`<td style="color:var(--danger)">-₹${catMap[c].exp.toFixed(2)}</td></tr>`).join('');

      document.getElementById('tx-list').innerHTML = filtered.map(t => `
        <div class="tx-item">
          <div class="tx-info"><b>${t.desc}</b><small>${t.date} • ${t.category}</small>
            <div style="margin-top:5px;"><span onclick="editTx(${t.id})" style="color:blue">EDIT</span> | <span onclick="delTx(${t.id})" style="color:red">DEL</span></div>
          </div>
          <div style="color:${t.type==='income'?'var(--success)':'#000'}; font-size:18px;">₹${t.amount.toFixed(2)}</div>
        </div>`).join('');
    });

    db.transaction("rem").objectStore("rem").getAll().onsuccess = (e) => {
      
    // PRIORITY SORT: overdue -> today/upcoming -> paid
    let today = new Date().getDate();
    
    
    let reminders = e.target.result.sort((a,b)=>{
      const p = r => r.done ? 3 : (today > r.day ? 1 : 2);
      return p(a) - p(b);
    });

    
    document.getElementById('rem-list').innerHTML = reminders.map(r => {
      let cls = r.done ? 'rem-paid' : (today > r.day ? 'rem-overdue' : 'rem-today');
      return `<div class="rem-item ${cls}">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <b>${r.name} (Day ${r.day})</b>
          <button class="btn-sm" style="background:var(--emerald)" onclick="toggleRem(${r.id})">
            ${r.done?'PAID':'MARK'}
          </button>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn-sm btn-edit" onclick="editRem(${r.id})">Edit</button>
          <button class="btn-sm btn-del" onclick="delRem(${r.id})">Del</button>
        </div>
      </div>`;
    }).join('');


    };
  }

  function editTx(id) {
    db.transaction("tx").objectStore("tx").get(id).onsuccess = (e) => {
      const t = e.target.result;
      document.getElementById('tr-date').value = t.date; document.getElementById('tr-amount').value = t.amount;
      document.getElementById('tr-type').value = t.type; document.getElementById('tr-cat').value = t.category;
      document.getElementById('tr-desc').value = t.desc; document.getElementById('edit-id').value = t.id;
      window.scrollTo(0,0);
    };
  }

  function openViewMode() {
    const activeMonth = getCurrentMonthKey();
    getFilteredData((filtered) => {
      filtered = filtered.filter(t => (t.monthKey || getMonthKey(t.date)) === activeMonth);
      if(filtered.length === 0) return alert("No data for current filters");
      let inc=0, exp=0;
      let rows = filtered.map(t => {
        if(t.type === 'income') inc += t.amount; else exp += t.amount;
        return `<tr><td>${t.date}</td><td>${t.desc}</td><td>${t.category}</td><td>${t.type==='income'?'+':'-'}₹${t.amount.toFixed(2)}</td></tr>`;
      }).join('');
      document.getElementById('modal-summary').innerHTML = `<b>IN: <span style="color:green">₹${inc.toFixed(2)}</span> | OUT: <span style="color:red">₹${exp.toFixed(2)}</span> | Net: ₹${(inc-exp).toFixed(2)}</b>`;
      document.getElementById('modal-rows').innerHTML = rows;
      document.getElementById('view-modal').style.display = 'block';
    });
  }

  function closeViewMode() { document.getElementById('view-modal').style.display = 'none'; }

  function exportPDF() {
    const start = document.getElementById('range-start').value, end = document.getElementById('range-end').value;
    const fCat = document.getElementById('filter-cat').value;
    if (!start || !end) return alert("Select Date Range");
    const activeMonth = getCurrentMonthKey();
    getFilteredData((filtered) => {
      filtered = filtered.filter(t => (t.monthKey || getMonthKey(t.date)) === activeMonth);
      const { jsPDF } = window.jspdf; const doc = new jsPDF();
      let inc=0, exp=0;
      filtered.forEach(t => { if(t.type==='income') inc+=t.amount; else exp+=t.amount; });
      
      doc.setFontSize(14);
      doc.text(`Report: ${start} to ${end} (Cat: ${fCat})`, 14, 15);
      doc.setFontSize(11);
      doc.text(`Total Income: Rs. ${inc.toFixed(2)} | Total Expense: Rs. ${exp.toFixed(2)} | Net: Rs. ${(inc-exp).toFixed(2)}`, 14, 22);
      
      doc.autoTable({ head:[['Date','Desc','Cat','Type','Amt']], body:filtered.map(t=>[t.date, t.desc, t.category, t.type.toUpperCase(), t.amount.toFixed(2)]), startY: 28 });
      doc.save(`Expense_Report_${fCat}.pdf`);
    });
  }

  function exportExcel() {
    const start = document.getElementById('range-start').value, end = document.getElementById('range-end').value;
    const fCat = document.getElementById('filter-cat').value;
    if(!start || !end) return alert("Select range");
    const activeMonth = getCurrentMonthKey();
    getFilteredData((filtered) => {
      filtered = filtered.filter(t => (t.monthKey || getMonthKey(t.date)) === activeMonth);
      let inc=0, exp=0;
      filtered.forEach(t => { if(t.type==='income') inc+=t.amount; else exp+=t.amount; });
      
      const cleanData = filtered.map(({id, ...rest}) => {
          rest.amount = parseFloat(rest.amount.toFixed(2));
          return rest;
      });
      // Add summary row at the end
      cleanData.push({});
      cleanData.push({desc: "TOTAL INCOME", amount: parseFloat(inc.toFixed(2))});
      cleanData.push({desc: "TOTAL EXPENSE", amount: parseFloat(exp.toFixed(2))});
      cleanData.push({desc: "NET BALANCE", amount: parseFloat((inc-exp).toFixed(2))});

      const ws = XLSX.utils.json_to_sheet(cleanData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Report");
      XLSX.writeFile(wb, `Report_${fCat}.xlsx`);
    });
  }

  function delTx(id) { if(confirm("Delete?")) db.transaction("tx","readwrite").objectStore("tx").delete(id).onsuccess = render; }
  function toggleRemForm() { const f = document.getElementById('rem-form'); f.style.display = f.style.display==='none'?'block':'none'; }
  function saveReminder() {
    const n = document.getElementById('rn').value, d = parseInt(document.getElementById('rd').value), eid = document.getElementById('rem-edit-id').value;
    if(!n || !d) return alert("Fill Name & Day");
    const s = db.transaction("rem", "readwrite").objectStore("rem");
    const obj = { name: n, day: d, done: false };
    if (eid) { obj.id = Number(eid); s.put(obj); } else { s.add(obj); }
    document.getElementById('rn').value = ""; document.getElementById('rd').value = ""; toggleRemForm(); render();
  }
  function editRem(id) {
    db.transaction("rem").objectStore("rem").get(id).onsuccess = (e) => {
      const r = e.target.result; document.getElementById('rn').value = r.name; document.getElementById('rd').value = r.day;
      document.getElementById('rem-edit-id').value = r.id; toggleRemForm();
    };
  }
  function delRem(id) { if(confirm("Delete Reminder?")) db.transaction("rem","readwrite").objectStore("rem").delete(id).onsuccess = render; }
  function toggleRem(id) {
    const s = db.transaction("rem","readwrite").objectStore("rem");
    s.get(id).onsuccess=(e)=>{ const r=e.target.result; r.done=!r.done; s.put(r).onsuccess=render; };
  }
  function exportJSON() {
    db.transaction("tx").objectStore("tx").getAll().onsuccess=(e)=>{
      const a = document.createElement("a"); a.href = URL.createObjectURL(new Blob([JSON.stringify(e.target.result)], {type:"application/json"}));
      a.download = "Tracker_Backup.json"; a.click();
    };
  }
  function importJSON(input) {
    const r = new FileReader(); r.onload = () => {
      const data = JSON.parse(r.result);
      const s = db.transaction("tx", "readwrite").objectStore("tx");
      data.forEach(item => { delete item.id; s.add(item); });
      render();
    }; r.readAsText(input.files[0]);
  }

function openDayModal(){document.getElementById('dayModal').style.display='block';document.getElementById('day-modal-body').innerHTML=document.getElementById('day-summary').innerHTML}
function closeDayModal(){document.getElementById('dayModal').style.display='none'}
function openRemModal(){document.getElementById('remModal').style.display='block';document.getElementById('rem-modal-body').innerHTML=document.getElementById('rem-list').innerHTML}
function closeRemModal(){document.getElementById('remModal').style.display='none'}


function getMonthKey(dateStr){
  const d = new Date(dateStr);
  return d.getFullYear() + "-" + String(d.getMonth()+1).padStart(2,'0');
}

function getCurrentMonthKey(){
  const d = new Date();
  return d.getFullYear() + "-" + String(d.getMonth()+1).padStart(2,'0');
}



</script>

<div class="modal-full" id="dayModal">
  <div class="modal-box">
    <div class="modal-head">
      <b>Monthly Day Summary</b>
      <div>
        <button class="btn-sm" onclick="window.print()">PRINT</button>
        <button class="btn-sm btn-del" onclick="closeDayModal()">CLOSE</button>
      </div>
    </div>
    <div class="month-grid" id="day-modal-body"></div>
  </div>
</div>

<div class="modal-full" id="remModal">
  <div class="modal-box">
    <div class="modal-head">
      <b>All Reminders</b>
      <div>
        <button class="btn-sm" onclick="window.print()">PRINT</button>
        <button class="btn-sm btn-del" onclick="closeRemModal()">CLOSE</button>
      </div>
    </div>
    <div id="rem-modal-body"></div>
  </div>
</div>

</body>
</html>
